<!DOCTYPE html>
<html lang="ar" dir="rtl" id="main-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABSI NEXUS | Login</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0b0e11; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background-color: #1e2329; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); text-align: center; width: 350px; position: relative; }
        .logo { color: #f0b90b; font-size: 40px; font-weight: bold; margin-bottom: 10px; }
        h2 { color: white; font-size: 18px; margin-bottom: 25px; }
        input { width: 100%; padding: 14px; border-radius: 5px; border: 1px solid #474d57; background-color: #2b3139; color: white; box-sizing: border-box; outline: none; margin: 8px 0; text-align: center; font-size: 16px; }
        button#main-btn { width: 100%; padding: 14px; background-color: #f0b90b; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 15px; font-size: 16px; color: #000; }
        .link { color: #f0b90b; cursor: pointer; font-size: 14px; margin-top: 15px; display: block; text-decoration: none; }
    </style>
</head>
<body>

    <div class="container">
        <div class="logo">ABSI</div>
        <h2 id="form-title">تسجيل الدخول</h2>
        
        <input type="text" id="username" placeholder="اسم المستخدم">
        <div id="email-group" style="display:none;"><input type="email" id="useremail" placeholder="البريد الإلكتروني"></div>
        <input type="password" id="password" placeholder="كلمة المرور">
        
        <button id="main-btn" onclick="handleAction()">دخول للمنصة</button>
        
        <div id="toggle-section" style="margin-top: 20px;">
            <a class="link" id="toggle-link" onclick="toggleForm()">إنشاء حساب جديد</a>
        </div>
    </div>

    <script>
        // إعدادات Firebase الخاصة بك
        const firebaseConfig = { databaseURL: "https://riabsi-default-rtdb.firebaseio.com" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let isRegisterMode = false;

        function toggleForm() {
            isRegisterMode = !isRegisterMode;
            document.getElementById('form-title').innerText = isRegisterMode ? "إنشاء حساب جديد" : "تسجيل الدخول";
            document.getElementById('email-group').style.display = isRegisterMode ? "block" : "none";
            document.getElementById('main-btn').innerText = isRegisterMode ? "تسجيل الحساب" : "دخول للمنصة";
            document.getElementById('toggle-link').innerText = isRegisterMode ? "لديك حساب؟ دخول" : "إنشاء حساب جديد";
        }

        function handleAction() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();

            if (!user || !pass) return alert("يرجى إدخال البيانات");

            if (isRegisterMode) {
                // عملية التسجيل
                const email = document.getElementById('useremail').value.trim();
                db.ref('users/' + user).set({ email: email, password: pass }).then(() => {
                    alert("تم التسجيل بنجاح! يمكنك الآن الدخول باسم المستخدم الخاص بك.");
                    toggleForm();
                });
            } else {
                // عملية الدخول (تبحث باسم المستخدم كما في صورك)
                db.ref('users/' + user).once('value', snapshot => {
                    if (snapshot.exists() && snapshot.val().password === pass) {
                        alert("نجح الدخول! جاري فتح المنصة...");
                        // توجيه نهائي لصفحة wallet.html
                        window.location.href = "wallet.html";
                    } else {
                        alert("خطأ: اسم المستخدم أو كلمة المرور غير صحيحة");
                    }
                });
            }
        }
    </script>
</body>
</html>
