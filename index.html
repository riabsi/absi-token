<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABSI Token | Exchange</title>
    <link rel="manifest" href="/manifest.json">

    <style>
        /* الخلفية والخطوط الأساسية - Dark Mode */
        body { 
            background-color: #0c1015; /* خلفية داكنة جداً */
            color: #e0e0e0; 
            font-family: 'Arial', sans-serif; 
            margin: 0; 
            height: 100vh; 
            display: flex; 
            flex-direction: column;
            overflow: hidden; 
            overflow-x: hidden; /* منع التمرير الأفقي بشكل قاطع */
        }

        /* شاشة التحقق/الإعداد (Auth Screen) */
        #auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0c1015;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        #auth-screen h1 {
            color: #ffc107;
            margin-bottom: 30px;
        }
        #passcode-input {
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #474d57;
            border-radius: 4px;
            background: #161a1e;
            color: #e0e0e0;
            text-align: center;
            font-size: 18px;
            width: 200px;
        }
        #auth-button {
            padding: 10px 30px;
            border: none;
            border-radius: 4px;
            background-color: #ffc107;
            color: #0c1015;
            cursor: pointer;
            font-weight: bold;
        }
        /* إخفاء المحتوى الرئيسي حتى يتم التحقق */
        #main-content {
            display: none; 
            flex-grow: 1;
            width: 100%;
        }
        
        /* شريط القائمة العلوي */
        .nav { 
            background: #161a1e; 
            padding: 10px 15px; /* تقليل الحشو الرأسي */
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-shrink: 0;
            border-bottom: 1px solid #2b3139;
        }
        .nav h2 {
            color: #ffc107; 
            margin: 0;
            font-size: 18px; /* تقليل حجم الخط من 24px إلى 18px */
        }
        /* حاوية المحتوى الرئيسية */
        .container { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
            padding: 8px; 
            max-width: none; 
            flex-grow: 1; 
            width: 100%;
        }
        /* قائمة اختيار العملة */
        select { 
            background: #2b3139; 
            color: #e0e0e0; 
            border: 1px solid #474d57; 
            padding: 8px 15px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 14px;
        }
        /* تخطيط الشبكة (Chart + Swap) على الأجهزة الكبيرة */
        .grid { 
            display: grid; 
            grid-template-columns: 75% 25%; 
            gap: 8px; 
            flex-grow: 1; 
        }
        /* إطارات Iframes (الرسم البياني وواجهة التداول) */
        iframe { 
            border: 1px solid #2b3139; 
            border-radius: 4px; 
            background: #161a1e; 
            /* حساب الارتفاع للأجهزة الكبيرة */
            height: calc(100vh - 65px); /* تم تعديل هذا الارتفاع ليتناسب مع شريط التنقل الأصغر */
            min-height: 500px; 
            width: 100%;
        }
        
        /* تصميم الأجهزة الصغيرة (هواتف) - المصحح النهائي */
        @media (max-width: 1000px) { 
            .nav { padding: 8px 10px; } /* تقليل الحشو أكثر للهواتف */

            .grid { 
                grid-template-columns: 1fr; 
                display: block; 
            } 

            #tradingChart, #swapWidget {
                height: 500px; 
                margin-bottom: 8px;
                min-height: 300px;
                width: 100%; /* الحل: إجبار عرض الإطار الداخلي على أن يكون 100% */
            }
            .container { 
                overflow-y: scroll; /* السماح بالتمرير داخل الحاوية */
                height: calc(100vh - 60px); /* تعديل ارتفاع الحاوية على الهواتف */
            } 
        }
    </style>
</head>
<body>

<div id="auth-screen">
    <h1>ABSI Exchange</h1>
    <p id="auth-message" style="color: #a0a0a0; margin-bottom: 5px;"></p>
    <input type="number" id="passcode-input" maxlength="4" placeholder="أربعة أرقام" pattern="\d{4}">
    <button id="auth-button" onclick="handleAuth()"></button>
    <p id="error-message" style="color: red; margin-top: 10px; display: none;">الرمز السري غير صحيح. حاول مرة أخرى.</p>
</div>


<div id="main-content">
    <div class="nav">
        <h2>ABSI Exchange</h2>
        <div>
            <label style="margin-right: 10px; color: #a0a0a0;">الزوج:</label>
            <select id="tokenSelector" onchange="updateChart()">
                <option value="0x6b744158428587d5b546304a0e980a3c2670e309">ABSI / USDT</option>
                <option value="0x55d398326f99059ff775485246999027b3197955">USDT / BNB</option>
                <option value="0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c">BNB / BUSD</option>
            </select>
        </div>
    </div>

    <div class="container">
        <div class="grid">
            <div id="chartContainer">
                <iframe id="tradingChart" src="https://www.geckoterminal.com/bsc/pools/0x6b744158428587d5b546304a0e980a3c2670e309?embed=1" loading="lazy" width="100%" allowfullscreen></iframe>
            </div>

            <div id="swapContainer">
                <iframe id="swapWidget" src="https://pancakeswap.finance/swap?outputCurrency=0x6b744158428587d5b546304a0e980a3c2670e309" loading="lazy" width="100%" allowfullscreen></iframe>
            </div>
        </div>
    </div>
</div>

<script>
    // **********************************************
    // وظيفة الرمز السري الديناميكي (Local Storage)
    // **********************************************
    const PASSCODE_KEY = 'absi_user_passcode';
    const inputField = document.getElementById('passcode-input');
    const authButton = document.getElementById('auth-button');
    const authMessage = document.getElementById('auth-message');
    const errorMsg = document.getElementById('error-message');

    document.addEventListener('DOMContentLoaded', initAuth);

    function getStoredPasscode() {
        return localStorage.getItem(PASSCODE_KEY);
    }

    function showMainContent() {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'flex';
    }

    function handleAuth() {
        const storedPasscode = getStoredPasscode();
        const input = inputField.value;

        if (input.length !== 4) {
            errorMsg.innerText = "الرمز السري يجب أن يكون 4 أرقام.";
            errorMsg.style.display = 'block';
            return;
        }

        if (storedPasscode) {
            // حالة: الرمز السري موجود (تحقق من الرمز)
            if (input === storedPasscode) {
                showMainContent();
            } else {
                errorMsg.innerText = "الرمز السري غير صحيح. حاول مرة أخرى.";
                errorMsg.style.display = 'block';
                inputField.value = '';
            }
        } else {
            // حالة: الرمز السري غير موجود (تعيين الرمز)
            localStorage.setItem(PASSCODE_KEY, input);
            errorMsg.style.display = 'none';
            alert('تم تعيين الرمز السري بنجاح! سيتم استخدامه في المرات القادمة.');
            showMainContent();
        }
    }

    function initAuth() {
        const storedPasscode = getStoredPasscode();
        if (storedPasscode) {
            // الرمز موجود: اطلب من المستخدم إدخاله
            authMessage.innerText = "الرجاء إدخال الرمز السري للمتابعة:";
            authButton.innerText = "دخول";
            inputField.placeholder = "الرمز السري الخاص بك";
        } else {
            // الرمز غير موجود: اطلب من المستخدم تعيينه
            authMessage.innerText = "الرجاء تعيين رمز سري مكون من 4 أرقام:";
            authButton.innerText = "تعيين الرمز";
            inputField.placeholder = "اختر رمزاً سرياً";
        }
    }

    // **********************************************
    // وظيفة تحديث الرسوم البيانية
    // **********************************************
    function updateChart() {
        const tokenAddress = document.getElementById('tokenSelector').value;
        document.getElementById('tradingChart').src = `https://www.geckoterminal.com/bsc/pools/${tokenAddress}?embed=1`;
        document.getElementById('swapWidget').src = `https://pancakeswap.finance/swap?outputCurrency=${tokenAddress}`;
    }
</script>

</body>
</html>
