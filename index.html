<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ABSI NEXUS PRO</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --bg: #0b0e11; --panel: #1e2329; --gold: #f0b90b; --buy: #0ecb81; --sell: #f6465d; --text: #eaecef; --dim: #848e9c; }
        body { background: var(--bg); color: var(--text); margin: 0; font-family: sans-serif; height: 100vh; overflow: hidden; }
        
        .page { display: none; height: calc(100vh - 70px); overflow-y: auto; width: 100%; }
        .page.active { display: flex; flex-direction: column; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 70px; background: #161a1e; display: flex; border-top: 1px solid #2b3139; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--dim); cursor: pointer; transition: 0.2s; font-size: 0.7rem; }
        .nav-item i { font-size: 1.2rem; margin-bottom: 4px; }
        .nav-item.active { color: var(--gold); }

        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .auth-box { background: var(--panel); padding: 30px; border-radius: 15px; border: 1px solid var(--gold); width: 300px; text-align: center; }
        
        /* زيادة الارتفاع قليلاً لاستيعاب المؤشرات الجديدة */
        #chart-zone { height: 50vh; background: #000; }
        
        .trade-zone { flex: 1; background: var(--panel); padding: 15px; border-top: 2px solid var(--gold); }
        input { width: 100%; padding: 12px; margin: 8px 0; background: #2b3139; border: 1px solid #444; color: white; border-radius: 8px; box-sizing: border-box; }
        .empty-page { display: flex; align-items: center; justify-content: center; height: 100%; color: var(--dim); font-size: 1.2rem; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box">
            <h2 style="color:var(--gold)">ABSI NEXUS</h2>
            <input type="text" id="username" placeholder="اسم المستخدم">
            <input type="password" id="password" placeholder="كلمة المرور">
            <button onclick="handleAuth()" style="width:100%; padding:12px; background:var(--gold); border:none; border-radius:8px; font-weight:bold; cursor:pointer;">دخول</button>
        </div>
    </div>

    <div id="main-container">
        <div id="page-home" class="page"><div class="empty-page">صفحة الرئيسية قريباً...</div></div>
        <div id="page-markets" class="page"><div class="empty-page">صفحة الأسواق قريباً...</div></div>

        <div id="page-trade" class="page active">
            <div style="background:#181a20; padding:10px 15px; display:flex; justify-content:space-between; align-items:center;">
                <select id="pairSelector" onchange="changePair(this.value)" style="background:none; color:var(--gold); border:none; font-weight:bold; outline:none;">
                    <option value="BTCUSDT">BTC/USDT</option>
                    <option value="ETHUSDT">ETH/USDT</option>
                </select>
                <span id="live-price" style="color:var(--gold); font-weight:bold;">0.00$</span>
            </div>
            
            <div id="chart-zone">
                <div id="tv_chart" style="height:100%;"></div>
            </div>

            <div class="trade-zone">
                <input type="number" id="trade-amt" placeholder="المبلغ USDT" value="10">
                <div style="display:flex; gap:10px;">
                    <button onclick="openTrade('BUY')" style="flex:1; background:var(--buy); color:white; padding:15px; border:none; border-radius:8px; font-weight:bold;">شراء</button>
                    <button onclick="openTrade('SELL')" style="flex:1; background:var(--sell); color:white; padding:15px; border:none; border-radius:8px; font-weight:bold;">بيع</button>
                </div>
                <div id="orders-container" style="margin-top:10px;"></div>
            </div>
        </div>

        <div id="futures" class="page-content">
    <div style="background: var(--bg); padding: 8px 15px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between;">
        <div onclick="toggleMarketList()" style="cursor:pointer; display:flex; align-items:center; gap:8px;">
            <strong style="font-size:16px; color:white;">BTCUSDT</strong>
            <span style="background:var(--card); color:var(--yellow); font-size:10px; padding:2px 5px; border-radius:3px;">20x</span>
            <i class="fas fa-caret-down" style="color:var(--dim)"></i>
        </div>
        <div style="text-align: left;">
            <span style="color:var(--green); font-weight:bold; font-size:14px;" id="livePriceTop">98,420.50</span>
            <div style="font-size:9px; color:var(--dim)">0.0100% 04:12:05</div>
        </div>
    </div>

    <div style="display:flex; padding:10px; gap:12px;">
        
        <div style="flex: 1; display: flex; flex-direction: column; background: var(--bg); padding: 5px; border-radius: 4px;">
            <div style="display:flex; justify-content:space-between; color:var(--dim); font-size:10px; margin-bottom:8px;">
                <span>السعر</span>
                <span>الكمية</span>
            </div>
            
            <div id="liveOrderBookRed" style="display: flex; flex-direction: column-reverse; gap: 2px;"></div>
            
            <div id="livePriceMidContainer" style="margin: 12px 0; text-align: center; border-top: 1px solid #2b3139; border-bottom: 1px solid #2b3139; padding: 8px 0;">
                <div id="livePriceMid" style="font-size:18px; font-weight:bold; color:var(--green);">98,420.50</div>
                <div style="font-size:10px; color:var(--dim)">$98,420.50</div>
            </div>
            
            <div id="liveOrderBookGreen" style="display: flex; flex-direction: column; gap: 2px;"></div>
        </div>

        <div style="flex: 1.2;">
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button onclick="toggleMarginMode(this)" style="flex:1; background:var(--card); color:white; border:1px solid var(--border); padding:6px; border-radius:4px; font-size:11px;">متقاطع</button>
                <button onclick="changeLeverage()" style="flex:1; background:var(--card); color:white; border:1px solid var(--border); padding:6px; border-radius:4px; font-size:11px;"><span id="levDisplay">20x</span></button>
            </div>

            <div style="display:flex; background:var(--card); border-radius:4px; margin-bottom:10px; overflow:hidden; border:1px solid var(--border); height:35px;">
                <button id="fLong" onclick="setFMode('long')" style="background:var(--green); color:white; flex:1; border:none; font-weight:bold;">شراء</button>
                <button id="fShort" onclick="setFMode('short')" style="background:none; color:var(--dim); flex:1; border:none; font-weight:bold;">بيع</button>
            </div>

            <div class="input-group" style="margin-bottom:8px; background:var(--card); padding:8px; border-radius:4px; display:flex; justify-content:space-between;">
                <input type="number" id="futuresPriceInput" value="98420.50" style="background:none; border:none; color:white; width:70%;">
                <span style="color:var(--dim); font-size:12px;">USDT</span>
            </div>

            <div class="input-group" style="margin-bottom:8px; background:var(--card); padding:8px; border-radius:4px; display:flex; justify-content:space-between;">
                <input type="number" id="futuresQtyInput" placeholder="الكمية" oninput="calculateCost()" style="background:none; border:none; color:white; width:70%;">
                <span style="color:var(--dim); font-size:12px;">BTC</span>
            </div>

            <input type="range" id="percentSlider" min="0" max="100" value="0" style="width:100%; margin:15px 0;" oninput="updateByPercent(this.value)">
            
            <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:15px;">
                <span style="color:var(--dim)">التكلفة</span>
                <span><span id="costDisplay">0.00</span> USDT</span>
            </div>

            <button id="fAction" onclick="executeTrade()" style="width:100%; padding:14px; background:var(--green); color:white; border:none; border-radius:6px; font-weight:bold; font-size:15px;">شراء / Long</button>
        </div>
    </div>
        </div>
        <div id="page-assets" class="page"><div class="empty-page">صفحة الأصول والمحفظة قريباً...</div></div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item" onclick="showPage('page-home', this)"><i class="fas fa-home"></i><span>الرئيسية</span></div>
        <div class="nav-item" onclick="showPage('page-markets', this)"><i class="fas fa-chart-bar"></i><span>الأسواق</span></div>
        <div class="nav-item active" onclick="showPage('page-trade', this)"><i class="fas fa-exchange-alt"></i><span>التداول</span></div>
        <div class="nav-item" onclick="showPage('page-futures', this)"><i class="fas fa-bolt"></i><span>العقود</span></div>
        <div class="nav-item" onclick="showPage('page-assets', this)"><i class="fas fa-wallet"></i><span>الأصول</span></div>
    </nav>

    <script>
        // دالة تغيير العملة وتفعيل المؤشرات
        function changePair(pair) {
            document.getElementById('tv_chart').innerHTML = "";
            new TradingView.widget({
                "autosize": true,
                "symbol": "BINANCE:" + pair,
                "interval": "1",
                "theme": "dark",
                "style": "1",
                "locale": "ar",
                "container_id": "tv_chart",
                "hide_side_toolbar": true,
                "allow_symbol_change": false,
                "studies": [
                    "RSI@tv-basicstudies",
                    "MACD@tv-basicstudies"
                ]
            });
            // كود الـ WebSocket المعتاد لتحديث السعر...
        }

        function showPage(pageId, element) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            element.classList.add('active');
            if(pageId === 'page-trade') {
                setTimeout(() => { changePair(document.getElementById('pairSelector').value); }, 100);
            }
        }

        function handleAuth() {
            document.getElementById('auth-screen').style.display = 'none';
            changePair("BTCUSDT");
        }
    </script>
</body>
</html>
