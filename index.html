<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ABSI NEXUS | Secure Login</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --bg: #0b0e11; --panel: #1e2329; --gold: #f0b90b; --text: #eaecef; }
        body { background: var(--bg); color: var(--text); margin: 0; font-family: sans-serif; height: 100vh; overflow: hidden; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .auth-box { background: var(--panel); padding: 30px; border-radius: 20px; border: 1px solid var(--gold); width: 100%; max-width: 340px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .auth-input { width: 100%; padding: 14px; margin: 8px 0; background: #2b3139; border: 1px solid #444; border-radius: 10px; color: white; box-sizing: border-box; font-size: 1rem; outline: none; transition: 0.3s; }
        .auth-input:focus { border-color: var(--gold); }
        .auth-btn { width: 100%; padding: 15px; background: var(--gold); border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 15px; font-size: 1rem; color: #000; }
        .toggle-text { font-size: 0.8rem; color: #848e9c; cursor: pointer; margin-top: 15px; display: block; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        header { height: 65px; background: var(--panel); display: flex; justify-content: space-between; align-items: center; padding: 0 15px; border-bottom: 1px solid #333; position: relative; }
        .brand-center { position: absolute; left: 50%; transform: translateX(-50%); color: var(--gold); font-weight: bold; font-size: 1.2rem; }
        .header-left { display: flex; align-items: center; gap: 10px; cursor: pointer; background: rgba(240, 185, 11, 0.1); padding: 5px 10px; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box">
            <h2 style="color:var(--gold); margin-bottom:10px;">ABSI NEXUS</h2>
            <div id="auth-mode-title" style="font-size:0.9rem; margin-bottom:20px; color:#848e9c;">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ / Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</div>
            
            <input type="text" id="username" class="auth-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)">
            <input type="password" id="password" class="auth-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <input type="email" id="user-email" class="auth-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            
            <button class="auth-btn" onclick="handleAuth()">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†ØµØ©</button>
            
            <div class="toggle-text" onclick="recoverAccount()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ Ø§Ø³ØªØ¹Ø¯Ù‡Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</div>
        </div>
    </div>

    <header id="main-header" style="display:none;">
        <div style="display:flex; align-items:center; gap:12px;">
            <span style="font-size:1.4rem;">ğŸ””</span>
            <div style="display:flex; background:#000; border-radius:15px; padding:2px; border:1px solid #444;">
                <button id="rBtn" onclick="switchMode('REAL')" style="background:none; border:none; color:#848e9c; font-size:0.6rem; padding:5px 10px; cursor:pointer;">Ø­Ù‚ÙŠÙ‚ÙŠ</button>
                <button id="dBtn" onclick="switchMode('DEMO')" style="background:#2d83ff; border:none; color:white; font-size:0.6rem; padding:5px 10px; border-radius:12px; cursor:pointer;">ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
            </div>
        </div>
        
        <div class="brand-center">ABSI NEXUS</div>
        
        <div class="header-left" onclick="alert('ÙØªØ­ Ø§Ù„Ù…Ø­ÙØ¸Ø©')">
            <div style="text-align:left;">
                <div id="accLabel" style="font-size:0.55rem; color:#2d83ff;">Ù…Ø­ÙØ¸Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ</div>
                <div id="headBal" style="font-size:0.9rem; font-weight:bold;">0.00$</div>
            </div>
            <span>ğŸ’°</span>
        </div>
    </header>

    <div id="tv_container" style="height: calc(100vh - 65px); display:none;">
        </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase (Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ)
        const firebaseConfig = {
            apiKey: "AIzaSyBZ3NMwdz8GqUlVtE_WPLIBi8ZmR_uIy1U",
            authDomain: "absinexus.firebaseapp.com",
            projectId: "absinexus",
            databaseURL: "https://absinexus-default-rtdb.firebaseio.com/", 
            storageBucket: "absinexus.firebasestorage.app",
            messagingSenderId: "1037317212228",
            appId: "1:1037317212228:web:bf243fd222fa77726a1411"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function handleAuth() {
            const user = document.getElementById('username').value.trim().toLowerCase().replace(/[.@]/g, "_");
            const pass = document.getElementById('password').value.trim();
            const email = document.getElementById('user-email').value.trim();

            if (!user || !pass) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
                return;
            }

            db.ref('users/' + user).once('value', snapshot => {
                const userData = snapshot.val();

                if (userData) {
                    // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ -> Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
                    if (userData.password === pass) {
                        startApp(user);
                    } else {
                        alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
                    }
                } else {
                    // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ -> ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                    if (!email || !email.includes("@")) {
                        alert("Ù‡Ø°Ø§ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯. ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„.");
                        return;
                    }
                    
                    db.ref('users/' + user).set({
                        password: pass,
                        email: email,
                        balance_demo: 1000,
                        balance_real: 0,
                        createdAt: new Date().toISOString()
                    }).then(() => {
                        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!");
                        startApp(user);
                    });
                }
            });
        }

        function recoverAccount() {
            const email = prompt("Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ:");
            if (!email) return;

            db.ref('users').once('value', snapshot => {
                let found = false;
                snapshot.forEach(child => {
                    const data = child.val();
                    if (data.email === email) {
                        alert(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ!\n\nØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${child.key}\nÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${data.password}`);
                        found = true;
                    }
                });
                if (!found) alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ù„Ø¯ÙŠÙ†Ø§.");
            });
        }

        function startApp(user) {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-header').style.display = 'flex';
            document.getElementById('tv_container').style.display = 'block';
            // Ù‡Ù†Ø§ ØªÙƒÙ…Ù„ Ø¨Ù‚ÙŠØ© ÙƒÙˆØ¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø´Ø§Ø±Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø± ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            console.log("Welcome " + user);
        }
    </script>
</body>
</html>
